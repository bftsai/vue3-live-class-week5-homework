import{a as f,m as w}from"./mixinSwal-j6M9Kmkx.js";import{_ as v,c as h,b as t,w as k,e as x,a as o,h as l,o as g,n as r}from"./index-6mC5QWHS.js";import"./zh_TW-ZfJM3fGh.js";const c="https://ec-course-api.hexschool.io/",b={data(){return{user:{username:"",password:""}}},mixins:[f,w],props:["loginState","defaultTheme"],methods:{onSubmit(){this.login()},async login(){try{this.$emit("emit-toggleLoading");const e=(await this.axios.post(`${c}v2/admin/signin`,this.user)).data;this.showSuccess(e.message);const{token:s}=e;document.cookie=`hexToken=${s};expires=${new Date(e.expired)}`,this.user.username="",this.user.password="",this.$emit("emit-toggleLoading"),await this.checkLogin(),this.$router.push("productsAdnin")}catch(e){console.log(e),this.showError(e.response.data.message),this.$emit("emit-toggleLoading")}},async logOut(){try{const e=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.axios.defaults.headers.common.Authorization=e;const s=(await this.axios.post(`${c}v2/logout`)).data;console.log(s)}catch(e){console.log(e)}},async checkLogin(){try{this.$emit("emit-toggleLoading");const e=document.cookie.replace(/(?:(?:^|.*;\s*)someCookieName\s*=\s*([^;]*).*$)|^.*$/,"$1");this.axios.defaults.headers.common.Authorization=e;const s=(await this.axios.post(`${c}/v2/api/user/check`)).data;s.success&&this.$emit("emit-toggleLogin",s.success),this.$emit("emit-toggleLoading")}catch(e){this.$emit("emit-toggleLogin",e.response.data.success),this.$emit("emit-toggleLoading")}}},mounted(){this.$emit("emit-login"),this.checkLogin()}},$={class:"login"},L=o("div",{class:"container"},[o("h1",{class:"my-3"},"Login page")],-1),y={key:0,class:"container"},V={class:"col-md-4 mb-3"},S=o("label",{for:"username",class:"form-label"},"Email address",-1),A={class:"col-md-4 mb-3"},E=o("label",{for:"password",class:"form-label"},"Password",-1),C={class:"col-md-4"};function T(e,s,i,N,a,p){const m=l("v-field"),d=l("error-message"),_=l("v-form");return g(),h("div",$,[L,i.loginState?x("",!0):(g(),h("div",y,[t(_,{onSubmit:p.onSubmit,class:"row g-3 needs-validation flex-column align-items-center",novalidate:""},{default:k(({errors:u})=>[o("div",V,[S,t(m,{type:"email",name:"Email Address",class:r(["form-control",{"is-invalid":u["Email Address"]}]),id:"username",placeholder:"name@example.com",rules:"required|email",modelValue:a.user.username,"onUpdate:modelValue":s[0]||(s[0]=n=>a.user.username=n)},null,8,["class","modelValue"]),t(d,{class:"invalid-feedback",name:"Email Address"})]),o("div",A,[E,t(m,{type:"password",name:"Password",class:r(["form-control",{"is-invalid":u.Password}]),id:"password",placeholder:"請輸入密碼",rules:"required",modelValue:a.user.password,"onUpdate:modelValue":s[1]||(s[1]=n=>a.user.password=n)},null,8,["class","modelValue"]),t(d,{class:"invalid-feedback",name:"Password"})]),o("div",C,[o("button",{class:r(["btn w-100",{"btn-secondary":i.defaultTheme==="light","btn-primary":i.defaultTheme==="dark"}]),type:"submit"},"Login",2)])]),_:1},8,["onSubmit"])]))])}const U=v(b,[["render",T]]);export{U as default};
