import{d,s as w,c as v,l as k,F as $,a as b,E as x,z as L,r as V,e as y,b as z}from"./zh_TW-fp4ksQRG.js";import{_ as C,c as h,l as a,w as E,p as T,a as o,s as l,o as p,n as r}from"./index-NgsiCtId.js";const c="https://ec-course-api.hexschool.io/";d("required",V);d("email",y);d("regex",z);w("zhTW");v({generateMessage:k({zhTW:L}),validateOnInput:!0});const S={data(){return{user:{username:"",password:""}}},components:{VForm:$,VField:b,ErrorMessage:x},props:["loginState","defaultTheme"],methods:{onSubmit(){this.login()},async login(){try{this.$emit("emit-toggleLoading");const e=(await this.axios.post(`${c}v2/admin/signin`,this.user)).data,s={icon:"success",title:e.message,timer:1500};this.$swal(s);const{token:t}=e;document.cookie=`hexToken=${t};expires=${new Date(e.expired)}`,this.user.username="",this.user.password="",this.$emit("emit-toggleLoading"),await this.checkLogin(),this.$router.push("products")}catch(e){console.log(e);const s={icon:"error",title:e.response.data.message};this.$swal(s),this.$emit("emit-toggleLoading")}},async logOut(){try{const e=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.axios.defaults.headers.common.Authorization=e;const s=(await this.axios.post(`${c}v2/logout`)).data;console.log(s)}catch(e){console.log(e)}},async checkLogin(){try{this.$emit("emit-toggleLoading");const e=document.cookie.replace(/(?:(?:^|.*;\s*)someCookieName\s*=\s*([^;]*).*$)|^.*$/,"$1");this.axios.defaults.headers.common.Authorization=e;const s=(await this.axios.post(`${c}/v2/api/user/check`)).data;s.success&&this.$emit("emit-toggleLogin",s.success),this.$emit("emit-toggleLoading")}catch(e){this.$emit("emit-toggleLogin",e.response.data.success),this.$emit("emit-toggleLoading")}}},mounted(){this.$emit("emit-login"),this.checkLogin()}},A={class:"login"},F=o("div",{class:"container"},[o("h1",{class:"my-3"},"Login page")],-1),q={key:0,class:"container"},N={class:"col-md-4 mb-3"},P=o("label",{for:"username",class:"form-label"},"Email address",-1),B={class:"col-md-4 mb-3"},U=o("label",{for:"password",class:"form-label"},"Password",-1),M={class:"col-md-4"};function O(e,s,t,W,i,f){const m=l("v-field"),u=l("error-message"),_=l("v-form");return p(),h("div",A,[F,t.loginState?T("",!0):(p(),h("div",q,[a(_,{onSubmit:f.onSubmit,class:"row g-3 needs-validation flex-column align-items-center",novalidate:""},{default:E(({errors:g})=>[o("div",N,[P,a(m,{type:"email",name:"Email Address",class:r(["form-control",{"is-invalid":g["Email Address"]}]),id:"username",placeholder:"name@example.com",rules:"required|email",modelValue:i.user.username,"onUpdate:modelValue":s[0]||(s[0]=n=>i.user.username=n)},null,8,["class","modelValue"]),a(u,{class:"invalid-feedback",name:"Email Address"})]),o("div",B,[U,a(m,{type:"password",name:"Password",class:r(["form-control",{"is-invalid":g.Password}]),id:"password",placeholder:"請輸入密碼",rules:"required",modelValue:i.user.password,"onUpdate:modelValue":s[1]||(s[1]=n=>i.user.password=n)},null,8,["class","modelValue"]),a(u,{class:"invalid-feedback",name:"Password"})]),o("div",M,[o("button",{class:r(["btn w-100",{"btn-secondary":t.defaultTheme==="light","btn-primary":t.defaultTheme==="dark"}]),type:"submit"},"Login",2)])]),_:1},8,["onSubmit"])]))])}const R=C(S,[["render",O]]);export{R as default};
