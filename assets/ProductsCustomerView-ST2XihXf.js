import{_ as V,x as E,h as r,i as t,n as u,m as j,F as b,p as x,j as c,k as C,y as q,l as v,t as h,w as D,s as p,o as d,v as k}from"./index-uOyjtneK.js";import{m as A,a as N}from"./mixinSwal-4k9RnbvI.js";import{a as U,P as I}from"./PaginationComponent-5cDrIFbg.js";import"./zh_TW-JQMouqhT.js";const m="https://ec-course-api.hexschool.io/",g="bftsai",O={data(){return{paginationObj:{},products:[],categoryArr:[],categorySelect:"",total:0,discount:0,itemSelect:{},clickItemNum:0,carts:[],isLoading:!1,orderData:{data:{user:{name:"",email:"",tel:"",address:""},message:""}}}},mixins:[A,N],props:["defaultTheme","loginState"],emits:["emitLogin","emitToggleLogin","emitToggleLoading"],components:{PaginationComponent:U,ProductCard:I,Loading:E},methods:{isPhoneNum(s){const e=/^09\d{8}$/;return s&&s!==null&&s!==void 0?e.test(s):!1},async getAllProducts(){try{(await this.axios.get(`${m}/v2/api/${g}/products/all`)).data.products.forEach(e=>{this.categoryArr.includes(e.category)||this.categoryArr.push(e.category)})}catch(s){console.log(s)}},async getProducts(s=1){try{this.$emit("emitToggleLoading");const e=(await this.axios.get(`${m}v2/api/${g}/products?page=${s}&category=${this.categorySelect}`)).data;this.$emit("emitToggleLoading"),this.paginationObj=e.pagination,this.products=e.products}catch(e){console.log(e)}},async changeCategory(s){try{if(s.target.value==="全部")this.categorySelect="",this.getProducts();else{this.$emit("emitToggleLoading"),this.categorySelect=s.target.value;const e=(await this.axios.get(`${m}v2/api/${g}/products?category=${this.categorySelect}`)).data;this.$emit("emitToggleLoading"),this.products=e.products,this.paginationObj=e.pagination}}catch(e){this.$emit("emitToggleLoading"),console.log(e)}},checkProduct(s,e){this.itemSelect.id!==s.id&&(this.clickItemNum=e.target.dataset.num,this.itemSelect=s)},async getAllCarts(){try{const s=(await this.axios(`${m}/v2/api/${g}/cart`)).data.data.carts;this.total=0,this.discount=0,s.forEach(e=>{this.total+=e.qty*e.product.origin_price,this.discount+=e.qty*e.product.price}),this.carts=s}catch(s){console.log(s)}},async postCart(s){try{const e={data:{product_id:s,qty:1}};this.$emit("emitToggleLoading");const l=(await this.axios.post(`${m}/v2/api/${g}/cart`,e)).data;this.$emit("emitToggleLoading"),l.success?this.showSuccess(l.message):this.showError(l.message),this.getAllCarts()}catch(e){console.log(e)}},async putCart(s,e){try{const l={data:{product_id:s,qty:Number(e.toFixed(0))}};this.$emit("emitToggleLoading");const _=(await this.axios.put(`${m}/v2/api/${g}/cart/${s}`,l)).data;this.$emit("emitToggleLoading"),_.success?(this.getAllCarts(),this.showSuccess(_.message)):this.showError(_.message)}catch(l){this.$emit("emitToggleLoading"),console.log(l)}},async deleteCart(s){try{this.isLoading=!0;const e=(await this.axios.delete(`${m}/v2/api/${g}/cart/${s}`)).data;this.isLoading=!1,e.success?this.showSuccess(e.message):this.showError(e.message),this.getAllCarts()}catch(e){console.log(e),this.isLoading=!1}},async deleteCarts(){try{if(!this.carts.length){this.showError("購物車沒有商品");return}this.isLoading=!0;const s=(await this.axios.delete(`${m}/v2/api/${g}/carts`)).data;this.isLoading=!1,s.success?this.showSuccess(s.message):this.showError(s.message),this.getAllCarts()}catch(s){this.isLoading=!1,console.log(s)}},async postOrder(){try{if(!this.carts.length){this.showError("購物車沒有商品");return}this.$emit("emitToggleLoading");const s=(await this.axios.post(`${m}/v2/api/${g}/order`,this.orderData)).data;this.$emit("emitToggleLoading"),s.success?this.showSuccess(s.message):this.showError(s.message),this.getAllCarts()}catch(s){this.$emit("emitToggleLoading"),console.log(s)}},EmitCloseSelectItem(){this.clickItemNum="",this.itemSelect=""}},mounted(){this.$emit("emitLogin"),this.$emit("emitToggleLogin",!0),this.getProducts(),this.getAllCarts(),this.getAllProducts()}},$={class:"container"},B=t("h1",null,"商品列表",-1),F={class:"row"},z={class:"col-12 col-lg-8"},M=t("option",{selected:"",disabled:""},"請選擇類別",-1),G=t("option",{value:"全部"},"全部",-1),H=["value"],J={class:"table"},K=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"圖片"),t("th",{scope:"col"},"商品名稱"),t("th",{scope:"col"},"價格"),t("th",{scope:"col"})])],-1),Q=["src","alt"],R={class:"w-25"},W={class:"line-through"},X={class:"fs-lg-4"},Y={class:"d-flex justify-content-center flex-column flex-lg-row"},Z=["onClick","data-num"],tt=["onClick"],et={class:"container"},st={class:"row position-relative"},ot={class:"col-lg-8"},at=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"品名"),t("th",{class:"text-center",scope:"col"},"數量/單位"),t("th",{class:"text-center",scope:"col"},"單價"),t("th",{class:"text-center",scope:"col"},"刪除")])],-1),lt={class:"d-flex justify-content-center"},it=["onUpdate:modelValue","onChange"],nt={class:"text-center"},ct={class:"d-flex justify-content-center"},rt=["onClick"],dt={key:0},ut=t("td",{class:"text-end",colspan:"3"},"總計",-1),ht={class:"text-end"},mt={key:1},gt=t("td",{class:"text-end",colspan:"3"},"折扣價",-1),pt={class:"text-end"},_t={key:0,class:"text-center fw-bold text-danger",colspan:"4"},ft={class:"container py-5"},yt={class:"col-lg-8"},bt=t("label",{for:"email",class:"form-label required"}," Email ",-1),vt={class:"col-lg-8"},xt=t("label",{for:"name",class:"form-label required"},"收件人姓名",-1),Ct={class:"col-lg-8"},wt=t("label",{for:"phone",class:"form-label required"},"收件人電話",-1),kt={class:"col-lg-8"},Lt=t("label",{for:"address",class:"form-label required"},"收件人地址",-1),St={class:"col-lg-8"},Tt=t("label",{for:"message",class:"form-label"},"留言",-1),Pt=t("div",{class:"col-lg-8 d-flex justify-content-end"},[t("button",{class:"btn btn-outline-danger",type:"submit"},"送出訂單")],-1);function Vt(s,e,l,_,a,n){const L=p("PaginationComponent"),S=p("ProductCard"),T=p("loading"),f=p("v-field"),y=p("error-message"),P=p("v-form");return d(),r(b,null,[t("div",$,[B,t("div",F,[t("div",z,[t("p",{class:u(["d-flex align-items-center",{"text-primary":l.defaultTheme==="dark"}])},[j("產品分類： "),t("select",{name:"",id:"",class:u(["form-select w-auto",{"text-primary":l.defaultTheme==="dark"}]),onChange:e[0]||(e[0]=(...o)=>n.changeCategory&&n.changeCategory(...o))},[M,G,(d(!0),r(b,null,x(a.categoryArr,o=>(d(),r("option",{value:o,key:o},h(o),9,H))),128))],34)],2),t("table",J,[K,t("tbody",null,[(d(!0),r(b,null,x(a.products,(o,i)=>(d(),r("tr",{key:o.id},[t("td",null,[t("img",{src:o.imageUrl,alt:o.title+"pic",class:"object-fit-cover"},null,8,Q)]),t("td",R,h(o.title),1),t("td",null,[t("p",W,"原價：$"+h(o.origin_price),1),t("p",X,"現在只要：$"+h(o.price),1)]),t("td",null,[t("div",Y,[t("button",{class:"btn btn-outline-secondary me-lg-3",onClick:w=>n.checkProduct(o,w),"data-num":i},"查看更多",8,Z),t("button",{class:"btn btn-outline-danger",onClick:w=>n.postCart(o.id)},"加到購物車",8,tt)])])]))),128))])]),c(L,{"pagination-obj":a.paginationObj,onEmitSelectPage:n.getProducts,"default-theme":l.defaultTheme},null,8,["pagination-obj","onEmitSelectPage","default-theme"])]),C(c(S,{"item-select":a.itemSelect,"click-item-num":a.clickItemNum,"default-theme":l.defaultTheme,onEmitCloseSelectItem:n.EmitCloseSelectItem},null,8,["item-select","click-item-num","default-theme","onEmitCloseSelectItem"]),[[q,a.itemSelect.id]])])]),t("div",{class:u(["py-5",{"bg-sm-light":l.defaultTheme==="light"}])},[t("div",et,[t("div",st,[t("div",ot,[c(T,{class:"pr-5",active:a.isLoading,"onUpdate:active":e[1]||(e[1]=o=>a.isLoading=o),opacity:.5,"is-full-page":!1,loader:"spinner",color:"#ff0000",weight:30,height:30,"lock-scroll":!0},null,8,["active"]),a.carts.length?(d(),r("button",{key:0,class:"btn btn-outline-danger d-block ms-auto w-auto mb-3",onClick:e[2]||(e[2]=(...o)=>n.deleteCarts&&n.deleteCarts(...o))},"清空購物車")):v("",!0),t("table",{class:u(["table table-hover mb-0",{"table-light":l.defaultTheme==="light"}])},[at,t("tbody",null,[(d(!0),r(b,null,x(a.carts,o=>(d(),r("tr",{key:o.id},[t("td",null,h(o.product.title),1),t("td",null,[t("div",lt,[C(t("input",{type:"number",class:u(["w-50px",{"text-danger":l.defaultTheme==="dark"}]),"onUpdate:modelValue":i=>o.qty=i,onChange:i=>n.putCart(o.id,o.qty),min:"1"},null,42,it),[[k,o.qty]]),t("span",null," / "+h(o.product.unit),1)])]),t("td",nt,h(o.product.origin_price),1),t("td",null,[t("div",ct,[t("button",{type:"button",class:"btn btn-outline-danger",onClick:i=>n.deleteCart(o.id)}," 刪除",8,rt)])])]))),128)),a.total?(d(),r("tr",dt,[ut,t("td",ht,h(a.total),1)])):v("",!0),a.discount?(d(),r("tr",mt,[gt,t("td",pt,h(a.discount),1)])):v("",!0),t("tr",null,[a.total?v("",!0):(d(),r("td",_t,"購物車沒有東西！！！"))])])],2)])])])],2),t("div",ft,[c(P,{class:u(["row g-3",{"text-primary":l.defaultTheme==="dark"}]),onSubmit:n.postOrder},{default:D(({errors:o})=>[t("div",yt,[bt,c(f,{type:"text",name:"email",class:u(["form-control",{"is-invalid":o.email}]),rules:"required|email",id:"email",modelValue:a.orderData.data.user.email,"onUpdate:modelValue":e[3]||(e[3]=i=>a.orderData.data.user.email=i)},null,8,["class","modelValue"]),c(y,{class:"invalid-feedback",name:"email"})]),t("div",vt,[xt,c(f,{type:"text",name:"name",class:u(["form-control",{"is-invalid":o.name}]),rules:"required",id:"name",modelValue:a.orderData.data.user.name,"onUpdate:modelValue":e[4]||(e[4]=i=>a.orderData.data.user.name=i)},null,8,["class","modelValue"]),c(y,{class:"invalid-feedback",name:"name"})]),t("div",Ct,[wt,c(f,{type:"text",name:"phone",class:u(["form-control",{"is-invalid":o.phone}]),rules:n.isPhoneNum,id:"phone",modelValue:a.orderData.data.user.tel,"onUpdate:modelValue":e[5]||(e[5]=i=>a.orderData.data.user.tel=i)},null,8,["class","rules","modelValue"]),c(y,{class:"invalid-feedback",name:"phone"})]),t("div",kt,[Lt,c(f,{type:"text",name:"address",class:u(["form-control",{"is-invalid":o.address}]),rules:"required",id:"address",modelValue:a.orderData.data.user.address,"onUpdate:modelValue":e[6]||(e[6]=i=>a.orderData.data.user.address=i)},null,8,["class","modelValue"]),c(y,{class:"invalid-feedback",name:"address"})]),t("div",St,[Tt,C(t("textarea",{name:"message",id:"message",class:"form-control",cols:"30",rows:"5","onUpdate:modelValue":e[7]||(e[7]=i=>a.orderData.data.message=i)},null,512),[[k,a.orderData.data.message]])]),Pt]),_:1},8,["onSubmit","class"])])],64)}const At=V(O,[["render",Vt]]);export{At as default};
