import{_ as $,o as d,c as r,a as t,F as y,r as w,t as a,n as h,s as E,f as j,b as u,d as P,j as U,e as x,w as q,h as f,v as L,p as A,k as N}from"./index-6mC5QWHS.js";import{m as M,a as I}from"./mixinSwal-j6M9Kmkx.js";import{M as O,a as B,P as F}from"./mixinModal-2tNl6KKZ.js";import"./zh_TW-ZfJM3fGh.js";const H="https://ec-course-api.hexschool.io/",J="bftsai",z={data(){return{tempProduct:{}}},props:{deleteModalCustomer:{typeof:Object,default(){return{}}}},mixins:[O,M],watch:{deleteModalCustomer(){this.tempProduct={...this.deleteModalCustomer.product}}},methods:{async deleteProduct(){try{this.$emit("emit-toggleLoading");const e=(await this.axios.delete(`${H}/v2/api/${J}/cart/${this.deleteModalCustomer.id}`)).data;this.$emit("emit-toggleLoading"),e.success?this.showSuccess(e.message):this.showError(e.message),this.hideModal()}catch(e){console.log(e),this.isLoading=!1}}}},G={class:"modal fade",id:"exampleModal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},K={class:"modal-dialog modal-xl"},Q={class:"modal-content"},R={class:"modal-header bg-danger"},W=t("h5",{class:"modal-title fs-5",id:"exampleModalLabel"},"Delete Product",-1),X={class:"modal-body"},Y={class:"row"},Z={class:"col-4"},tt={class:"row"},et={class:"col-12 mb-3 d-flex flex-wrap justify-content-between"},st=["src"],ot=["src"],lt={class:"col-8"},at={class:"mb-3 d-flex align-items-center"},it={class:"row"},ct={class:"col-6"},nt={class:"mb-3 d-flex align-items-center"},dt={class:"col-6"},rt={class:"mb-3 d-flex align-items-center"},ut={class:"row"},mt={class:"col-6"},ht={class:"mb-3 d-flex align-items-center"},gt={class:"col-6"},_t={class:"mb-3 d-flex align-items-center"},pt={class:"mb-3 d-flex align-items-center"},ft={class:"mb-3"},bt={class:"w-100"},yt={class:"mb-3 d-flex align-items-center"},vt={class:"modal-footer"};function Ct(e,s,c,b,o,i){return d(),r("div",G,[t("div",K,[t("div",Q,[t("div",R,[W,t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:s[0]||(s[0]=(...g)=>e.hideModal&&e.hideModal(...g))})]),t("div",X,[t("div",Y,[t("div",Z,[t("div",tt,[t("div",et,[t("img",{class:"object-fit-cover w-50 mb-3",src:o.tempProduct.imageUrl,alt:"imageUrl"},null,8,st),(d(!0),r(y,null,w(o.tempProduct.imagesUrl,(g,k)=>(d(),r("img",{class:"object-fit-cover w-50 mb-3",src:g,alt:"'imagesUrl' + key",key:"imagesUrl"+k},null,8,ot))),128))])])]),t("div",lt,[t("div",at,[t("p",null,"Title："+a(o.tempProduct.title),1)]),t("div",it,[t("div",ct,[t("div",nt,[t("p",null,"Category："+a(o.tempProduct.category),1)])]),t("div",dt,[t("div",rt,[t("p",null,"Unit："+a(o.tempProduct.unit),1)])])]),t("div",ut,[t("div",mt,[t("div",ht,[t("p",null,"origin_price："+a(o.tempProduct.origin_price),1)])]),t("div",gt,[t("div",_t,[t("p",null,"Price："+a(o.tempProduct.price),1)])])]),t("div",pt,[t("p",null,"Content："+a(o.tempProduct.content),1)]),t("div",ft,[t("div",bt,[t("p",null,"Description："+a(o.tempProduct.description),1)])]),t("div",yt,[t("p",{class:h(["text-success",{"text-danger":!o.tempProduct.is_enabled}])},a(o.tempProduct.is_enabled?"啟用":"未啟用"),3)])])])]),t("div",vt,[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",onClick:s[1]||(s[1]=(...g)=>e.hideModal&&e.hideModal(...g))},"Close"),t("button",{type:"submit",class:"btn btn-outline-danger",onClick:s[2]||(s[2]=(...g)=>i.deleteProduct&&i.deleteProduct(...g))},"Delete Product")])])])],512)}const xt=$(z,[["render",Ct]]),_="https://ec-course-api.hexschool.io/",p="bftsai",wt={data(){return{paginationObj:{},products:[],categoryArr:[],categorySelect:"",total:0,discount:0,itemSelect:{},clickItemNum:0,carts:[],isLoading:!1,orderData:{data:{user:{name:"",email:"",tel:"",address:""},message:""}}}},mixins:[I,M],props:["defaultTheme","loginState"],emits:["emitLogin","emitToggleLogin","emitToggleLoading"],components:{PaginationComponent:B,ProductCard:F,Loading:E,DeleteModalCustomer:xt},methods:{isPhoneNum(e){const s=/^09\d{8}$/;return e&&e!==null&&e!==void 0?s.test(e):!1},async getAllProducts(){try{(await this.axios.get(`${_}/v2/api/${p}/products/all`)).data.products.forEach(s=>{this.categoryArr.includes(s.category)||this.categoryArr.push(s.category)})}catch(e){console.log(e)}},async getProducts(e=1){try{this.$emit("emitToggleLoading");const s=(await this.axios.get(`${_}v2/api/${p}/products?page=${e}&category=${this.categorySelect}`)).data;this.$emit("emitToggleLoading"),this.paginationObj=s.pagination,this.products=s.products}catch(s){console.log(s)}},async changeCategory(e){try{if(e.target.value==="全部")this.categorySelect="",this.getProducts();else{this.$emit("emitToggleLoading"),this.categorySelect=e.target.value;const s=(await this.axios.get(`${_}v2/api/${p}/products?category=${this.categorySelect}`)).data;this.$emit("emitToggleLoading"),this.products=s.products,this.paginationObj=s.pagination}}catch(s){this.$emit("emitToggleLoading"),console.log(s)}},checkProduct(e,s){this.itemSelect.id!==e.id&&(this.clickItemNum=s.target.dataset.num,this.itemSelect=e)},async getAllCarts(){try{const e=(await this.axios(`${_}/v2/api/${p}/cart`)).data.data.carts;this.total=0,this.discount=0,e.forEach(s=>{this.total+=s.qty*s.product.origin_price,this.discount+=s.qty*s.product.price}),this.carts=e}catch(e){console.log(e)}},async postCart(e){try{const s={data:{product_id:e,qty:1}};this.$emit("emitToggleLoading");const c=(await this.axios.post(`${_}/v2/api/${p}/cart`,s)).data;this.$emit("emitToggleLoading"),c.success?this.showSuccess(c.message):this.showError(c.message),this.getAllCarts()}catch(s){console.log(s)}},async putCart(e,s,c){try{const b={data:{product_id:s,qty:Number(c.toFixed(0))}};this.$emit("emitToggleLoading");const o=(await this.axios.put(`${_}/v2/api/${p}/cart/${e}`,b)).data;this.$emit("emitToggleLoading"),o.success?(this.getAllCarts(),this.showSuccess(o.message)):this.showError(o.message)}catch(b){this.$emit("emitToggleLoading"),console.log(b)}},deleteCart(e){this.itemSelect=JSON.parse(JSON.stringify(e)),this.$refs.deleteModalCustomer.showModal()},hideDeleteModal(){this.itemSelect={},this.getAllCarts()},async deleteCarts(){try{if(!this.carts.length){this.showError("購物車沒有商品");return}this.isLoading=!0;const e=(await this.axios.delete(`${_}/v2/api/${p}/carts`)).data;this.isLoading=!1,e.success?this.showSuccess(e.message):this.showError(e.message),this.getAllCarts()}catch(e){this.isLoading=!1,console.log(e)}},async postOrder(){try{if(!this.carts.length){this.showError("購物車沒有商品");return}this.$emit("emitToggleLoading");const e=(await this.axios.post(`${_}/v2/api/${p}/order`,this.orderData)).data;this.$emit("emitToggleLoading"),e.success?this.showSuccess(e.message):this.showError(e.message),this.carts={},this.getAllCarts()}catch(e){this.$emit("emitToggleLoading"),console.log(e)}},EmitCloseSelectItem(){this.clickItemNum="",this.itemSelect=""}},mounted(){this.$emit("emitLogin"),this.$emit("emitToggleLogin",!0),this.getProducts(),this.getAllCarts(),this.getAllProducts()}},m=e=>(A("data-v-24dcf19c"),e=e(),N(),e),kt={class:"container"},Pt=m(()=>t("h1",null,"商品列表",-1)),St={class:"row"},Lt={class:"col-12 col-lg-8"},$t=m(()=>t("option",{selected:"",disabled:""},"請選擇類別",-1)),Mt=m(()=>t("option",{value:"全部"},"全部",-1)),Tt=["value"],Dt={class:"table"},Vt=m(()=>t("thead",null,[t("tr",null,[t("th",{scope:"col"},"圖片"),t("th",{scope:"col"},"商品名稱"),t("th",{scope:"col"},"價格"),t("th",{scope:"col"})])],-1)),Et=["src","alt"],jt={class:"w-25"},Ut={class:"line-through"},qt={class:"fs-lg-4"},At={class:"d-flex justify-content-center flex-column flex-lg-row"},Nt=["onClick","data-num"],It=["onClick"],Ot={class:"container"},Bt={class:"row position-relative"},Ft={class:"col-lg-8"},Ht=m(()=>t("thead",null,[t("tr",null,[t("th",{scope:"col"},"品名"),t("th",{class:"text-center",scope:"col"},"數量/單位"),t("th",{class:"text-center",scope:"col"},"單價"),t("th",{class:"text-center",scope:"col"},"刪除")])],-1)),Jt={class:"d-flex justify-content-center"},zt=["onUpdate:modelValue","onChange"],Gt={class:"text-center"},Kt={class:"d-flex justify-content-center"},Qt=["onClick"],Rt={key:0},Wt=m(()=>t("td",{class:"text-end",colspan:"3"},"總計",-1)),Xt={class:"text-end"},Yt={key:1},Zt=m(()=>t("td",{class:"text-end",colspan:"3"},"折扣價",-1)),te={class:"text-end"},ee={key:0,class:"text-center fw-bold text-danger",colspan:"4"},se={class:"container py-5"},oe={class:"col-lg-8"},le=m(()=>t("label",{for:"email",class:"form-label required"}," Email ",-1)),ae={class:"col-lg-8"},ie=m(()=>t("label",{for:"name",class:"form-label required"},"收件人姓名",-1)),ce={class:"col-lg-8"},ne=m(()=>t("label",{for:"phone",class:"form-label required"},"收件人電話",-1)),de={class:"col-lg-8"},re=m(()=>t("label",{for:"address",class:"form-label required"},"收件人地址",-1)),ue={class:"col-lg-8"},me=m(()=>t("label",{for:"message",class:"form-label"},"留言",-1)),he=m(()=>t("div",{class:"col-lg-8 d-flex justify-content-end"},[t("button",{class:"btn btn-outline-danger",type:"submit"},"送出訂單")],-1));function ge(e,s,c,b,o,i){const g=f("PaginationComponent"),k=f("ProductCard"),T=f("loading"),D=f("DeleteModalCustomer"),v=f("v-field"),C=f("error-message"),V=f("v-form");return d(),r(y,null,[t("div",kt,[Pt,t("div",St,[t("div",Lt,[t("p",{class:h(["d-flex align-items-center",{"text-primary":c.defaultTheme==="dark"}])},[j("產品分類： "),t("select",{name:"",id:"",class:h(["form-select w-auto",{"text-primary":c.defaultTheme==="dark"}]),onChange:s[0]||(s[0]=(...l)=>i.changeCategory&&i.changeCategory(...l))},[$t,Mt,(d(!0),r(y,null,w(o.categoryArr,l=>(d(),r("option",{value:l,key:l},a(l),9,Tt))),128))],34)],2),t("table",Dt,[Vt,t("tbody",null,[(d(!0),r(y,null,w(o.products,(l,n)=>(d(),r("tr",{key:l.id},[t("td",null,[t("img",{src:l.imageUrl,alt:l.title+"pic",class:"object-fit-cover"},null,8,Et)]),t("td",jt,a(l.title),1),t("td",null,[t("p",Ut,"原價：$"+a(l.origin_price),1),t("p",qt,"現在只要：$"+a(l.price),1)]),t("td",null,[t("div",At,[t("button",{type:"button",class:"btn btn-outline-secondary me-lg-3",onClick:S=>i.checkProduct(l,S),"data-num":n},"查看更多",8,Nt),t("button",{type:"button",class:"btn btn-outline-danger",onClick:S=>i.postCart(l.id)},"加到購物車",8,It)])])]))),128))])]),u(g,{"pagination-obj":o.paginationObj,onEmitSelectPage:i.getProducts,"default-theme":c.defaultTheme},null,8,["pagination-obj","onEmitSelectPage","default-theme"])]),P(u(k,{"item-select":o.itemSelect,"click-item-num":o.clickItemNum,"default-theme":c.defaultTheme,onEmitCloseSelectItem:i.EmitCloseSelectItem},null,8,["item-select","click-item-num","default-theme","onEmitCloseSelectItem"]),[[U,o.itemSelect.id]])])]),t("div",{class:h(["py-5",{"bg-sm-light":c.defaultTheme==="light"}])},[t("div",Ot,[t("div",Bt,[t("div",Ft,[u(T,{class:"pr-5",active:o.isLoading,"onUpdate:active":s[1]||(s[1]=l=>o.isLoading=l),opacity:.5,"is-full-page":!1,loader:"spinner",color:"#ff0000",weight:30,height:30,"lock-scroll":!0},null,8,["active"]),o.carts.length?(d(),r("button",{key:0,type:"button",class:"btn btn-outline-danger d-block ms-auto w-auto mb-3",onClick:s[2]||(s[2]=(...l)=>i.deleteCarts&&i.deleteCarts(...l))},"清空購物車")):x("",!0),t("table",{class:h(["table table-hover mb-0",{"table-light":c.defaultTheme==="light"}])},[Ht,t("tbody",null,[(d(!0),r(y,null,w(o.carts,l=>(d(),r("tr",{key:l.id},[t("td",null,a(l.product.title),1),t("td",null,[t("div",Jt,[P(t("input",{type:"number",class:h(["w-50px",{"text-danger":c.defaultTheme==="dark"}]),"onUpdate:modelValue":n=>l.qty=n,onChange:n=>i.putCart(l.id,l.product_id,l.qty),min:"1"},null,42,zt),[[L,l.qty]]),t("span",null," / "+a(l.product.unit),1)])]),t("td",Gt,a(l.product.origin_price),1),t("td",null,[t("div",Kt,[t("button",{type:"button",class:"btn btn-outline-danger",onClick:n=>i.deleteCart(l)}," 刪除",8,Qt)])])]))),128)),o.total?(d(),r("tr",Rt,[Wt,t("td",Xt,a(o.total),1)])):x("",!0),o.discount?(d(),r("tr",Yt,[Zt,t("td",te,a(o.discount),1)])):x("",!0),t("tr",null,[o.total?x("",!0):(d(),r("td",ee,"購物車沒有東西！！！"))])])],2)])])]),u(D,{ref:"deleteModalCustomer",deleteModalCustomer:o.itemSelect,onEmitHideModal:i.hideDeleteModal},null,8,["deleteModalCustomer","onEmitHideModal"])],2),t("div",se,[u(V,{class:h(["row g-3",{"text-primary":c.defaultTheme==="dark"}]),onSubmit:i.postOrder},{default:q(({errors:l})=>[t("div",oe,[le,u(v,{type:"email",name:"email",class:h(["form-control",{"is-invalid":l.email}]),rules:"required|email",id:"email",modelValue:o.orderData.data.user.email,"onUpdate:modelValue":s[3]||(s[3]=n=>o.orderData.data.user.email=n)},null,8,["class","modelValue"]),u(C,{class:"invalid-feedback",name:"email"})]),t("div",ae,[ie,u(v,{type:"text",name:"name",class:h(["form-control",{"is-invalid":l.name}]),rules:"required",id:"name",modelValue:o.orderData.data.user.name,"onUpdate:modelValue":s[4]||(s[4]=n=>o.orderData.data.user.name=n)},null,8,["class","modelValue"]),u(C,{class:"invalid-feedback",name:"name"})]),t("div",ce,[ne,u(v,{type:"tel",name:"phone",class:h(["form-control",{"is-invalid":l.phone}]),rules:i.isPhoneNum,id:"phone",modelValue:o.orderData.data.user.tel,"onUpdate:modelValue":s[5]||(s[5]=n=>o.orderData.data.user.tel=n)},null,8,["class","rules","modelValue"]),u(C,{class:"invalid-feedback",name:"phone"})]),t("div",de,[re,u(v,{type:"text",name:"address",class:h(["form-control",{"is-invalid":l.address}]),rules:"required",id:"address",modelValue:o.orderData.data.user.address,"onUpdate:modelValue":s[6]||(s[6]=n=>o.orderData.data.user.address=n)},null,8,["class","modelValue"]),u(C,{class:"invalid-feedback",name:"address"})]),t("div",ue,[me,P(t("textarea",{name:"message",id:"message",class:"form-control",cols:"30",rows:"5","onUpdate:modelValue":s[7]||(s[7]=n=>o.orderData.data.message=n)},null,512),[[L,o.orderData.data.message]])]),he]),_:1},8,["onSubmit","class"])])],64)}const ye=$(wt,[["render",ge],["__scopeId","data-v-24dcf19c"]]);export{ye as default};
