import{M as $,P as E,a as D}from"./mixinModal-2tNl6KKZ.js";import{d as j,c as N,l as O,s as I,z as F,F as q,a as z,E as A,r as B}from"./zh_TW-ZfJM3fGh.js";import{_ as U,o as r,c as g,a as e,b as a,w as L,d as P,v as V,n as c,e as f,f as x,F as M,r as C,g as G,h,t as u,i as H}from"./index-6mC5QWHS.js";const y="https://ec-course-api.hexschool.io/",w="bftsai";j("required",B);N({validateOnInput:!0,generateMessage:O({zhTW:F})});I("zhTW");const J={data(){return{tempProduct:{},imageUrl:"",disabled:!1,fileData:""}},mixins:[$],props:{productModal:{typeof:Object,default(){return{}}}},components:{VForm:q,VField:z,ErrorMessage:A},watch:{imageUrl(){this.imageUrl?this.disabled=!0:this.disabled=!1},productModal(){this.tempProduct={...this.productModal}}},methods:{throttle(s){let t,l;return(..._)=>{l=_,!t&&(s(l),l=null,t=setTimeout(()=>{t=null,l&&(s(l),l=null)},1e3))}},onSubmit(){this.tempProduct.imageUrl&&(this.disabled?this.tempProduct.is_enabled=0:this.tempProduct.is_enabled=1,this.tempProduct.id?this.putProduct({data:this.tempProduct}):this.postProduct({data:this.tempProduct}))},async postProduct(s){try{this.$emit("emit-toggleLoading");const t=(await this.axios.post(`${y}v2/api/${w}/admin/product`,s)).data;if(this.$emit("emit-toggleLoading"),t.success){const l={icon:"success",title:t.message,timer:1500};this.$swal(l),this.hideModal(),this.$emit("emit-getProducts")}else{const l={icon:"error",title:t.message};this.$swal(l)}}catch{}},async putProduct(s){try{this.$emit("emit-toggleLoading");const t=await this.axios.put(`${y}/v2/api/${w}/admin/product/${this.tempProduct.id}`,s);if(this.$emit("emit-toggleLoading"),t.data.success){const l={icon:"success",title:t.data.message,timer:1500};this.$swal(l),this.hideModal(),this.tempProduct={},this.$emit("emit-getProducts")}else{const l={icon:"error",title:t.data.message};this.$swal(l)}}catch{}},async loadFile(s){try{const t=s.target.files[0],l=new FormData;l.append("file-to-upload",t);const _=await this.axios.post(`${y}/v2/api/${w}/admin/upload`,l);this.imageUrl=_.data.imageUrl}catch{}},deleteImageUrl(){this.imageUrl="",this.fileData=""},deleteTempImage(s){if(s.target.previousElementSibling.alt.includes("imageUrl"))this.tempProduct.imageUrl="";else{const t=Number(s.target.previousElementSibling.alt.split("imagesUrl")[1]);this.tempProduct.imagesUrl.splice(t,1)}},addProductImage(){this.imageUrl&&(this.tempProduct.imageUrl?this.tempProduct.imagesUrl.push(this.imageUrl):this.tempProduct.imageUrl=this.imageUrl,this.imageUrl="")}}},W={class:"modal fade",id:"exampleModal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},R={class:"modal-dialog modal-xl"},K={class:"modal-header"},Q=e("h5",{class:"modal-title fs-5",id:"exampleModalLabel"},"Edit Product",-1),X={class:"modal-body"},Y={class:"row"},Z={class:"col-4"},ee={class:"row"},te={class:"col-12 mb-3 d-flex flex-column"},se=e("span",{class:"invalid-feedback",name:"imageUrl"},"請輸入主圖照片",-1),ie=["disabled"],oe={key:0,class:"col-12 mb-3 position-relative"},le=["src"],de=e("span",{class:"visually-hidden"},"unread messages",-1),ae={class:"row"},ne={key:0,class:"col-6 position-relative mb-3"},ce=["src"],re=e("span",{class:"visually-hidden"},"unread messages",-1),me=["src","alt"],ue=e("span",{class:"visually-hidden"},"unread messages",-1),ge={class:"col-8"},pe={class:"mb-3 d-flex align-items-center"},he=e("label",{for:"title",class:"form-label"},"Title：",-1),_e={class:"w-100 d-flex flex-column"},be={class:"row"},fe={class:"col-6"},ve={class:"mb-3 d-flex align-items-center"},Pe=e("label",{for:"category",class:"form-label"},"Category：",-1),xe={class:"w-100 d-flex flex-column"},ye={class:"col-6"},we={class:"mb-3 d-flex align-items-center"},ke=e("label",{for:"unit",class:"form-label"},"Unit：",-1),Ue={class:"w-100 d-flex flex-column"},Me={class:"row"},Ce={class:"col-6"},Le={class:"mb-3 d-flex align-items-center"},Ve=e("label",{for:"origin_price",class:"form-label"},"Origin_price：",-1),Te={class:"w-100 d-flex flex-column"},$e={class:"col-6"},Se={class:"mb-3 d-flex align-items-center"},Ee=e("label",{for:"price",class:"form-label"},"Price：",-1),De={class:"w-100 d-flex flex-column"},je={class:"mb-3 d-flex align-items-center"},Ne=e("label",{for:"num",class:"form-label"},"Number：",-1),Oe={class:"w-100 d-flex flex-column"},Ie={class:"mb-3 d-flex align-items-center"},Fe=e("label",{for:"content",class:"form-label"},"Content：",-1),qe={class:"w-100 d-flex flex-column"},ze={class:"mb-3"},Ae=e("label",{for:"description",class:"form-label"},"Description：",-1),Be={class:"w-100"},Ge={class:"mb-3 d-flex align-items-center"},He=["checked"],Je=e("label",{for:"is_enabled",class:"form-check-label"},"啟用",-1),We={class:"modal-footer"},Re=e("button",{type:"submit",class:"btn btn-primary"},"Save changes",-1);function Ke(s,t,l,_,i,d){const n=h("v-field"),m=h("error-message"),v=h("v-form");return r(),g("div",W,[e("div",R,[a(v,{class:"modal-content",onSubmit:d.onSubmit},{default:L(({errors:p})=>[e("div",K,[Q,e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:t[0]||(t[0]=(...o)=>s.hideModal&&s.hideModal(...o))})]),e("div",X,[e("div",Y,[e("div",Z,[e("div",ee,[e("div",te,[i.imageUrl?f("",!0):P((r(),g("input",{key:0,type:"text",placeholder:"請輸入圖片網址",name:"imageUrl",class:c(["form-control",{"is-invalid":!i.tempProduct.imageUrl}]),"onUpdate:modelValue":t[1]||(t[1]=o=>i.imageUrl=o)},null,2)),[[V,i.imageUrl]]),se,e("input",{type:"file",disabled:i.disabled,onChange:t[2]||(t[2]=(...o)=>d.loadFile&&d.loadFile(...o))},null,40,ie),e("button",{type:"button",class:"btn btn-primary me-3",onClick:t[3]||(t[3]=(...o)=>d.addProductImage&&d.addProductImage(...o))},"新增")]),i.imageUrl?(r(),g("div",oe,[e("img",{src:i.imageUrl,alt:"edit product pic",class:"object-fit-cover w-100"},null,8,le),e("span",{class:"position-absolute top-0 start-75 translate-middle badge rounded-circle bg-danger me-3",onClick:t[4]||(t[4]=(...o)=>d.deleteImageUrl&&d.deleteImageUrl(...o))},[x(" - "),de])])):f("",!0)]),e("div",ae,[i.tempProduct.imageUrl?(r(),g("div",ne,[e("img",{src:i.tempProduct.imageUrl,alt:"'imageUrl'",class:"object-fit-cover w-100"},null,8,ce),e("span",{class:"position-absolute top-0 start-75 translate-middle badge rounded-circle bg-danger me-3",onClick:t[5]||(t[5]=(...o)=>d.deleteTempImage&&d.deleteTempImage(...o))},[x(" - "),re])])):f("",!0),(r(!0),g(M,null,C(i.tempProduct.imagesUrl,(o,b)=>(r(),g("div",{class:"col-6 position-relative mb-3",key:"key"+b},[e("img",{src:o,alt:"imagesUrl"+b,class:"object-fit-cover w-100"},null,8,me),e("span",{class:"position-absolute top-0 start-75 translate-middle badge rounded-circle bg-danger me-3",onClick:t[6]||(t[6]=(...S)=>d.deleteTempImage&&d.deleteTempImage(...S))},[x(" - "),ue])]))),128))])]),e("div",ge,[e("div",pe,[he,e("div",_e,[a(n,{type:"text",id:"title",class:c(["form-control",{"is-invalid":p.Title}]),name:"Title",modelValue:i.tempProduct.title,"onUpdate:modelValue":t[7]||(t[7]=o=>i.tempProduct.title=o),rules:"required"},null,8,["class","modelValue"]),a(m,{class:"invalid-feedback",name:"Title"})])]),e("div",be,[e("div",fe,[e("div",ve,[Pe,e("div",xe,[a(n,{type:"text",id:"category",class:c(["form-control",{"is-invalid":p.Category}]),name:"Category",modelValue:i.tempProduct.category,"onUpdate:modelValue":t[8]||(t[8]=o=>i.tempProduct.category=o),rules:"required"},null,8,["class","modelValue"]),a(m,{class:"invalid-feedback",name:"Category"})])])]),e("div",ye,[e("div",we,[ke,e("div",Ue,[a(n,{type:"text",id:"unit",class:c(["form-control",{"is-invalid":p.Unit}]),name:"Unit",modelValue:i.tempProduct.unit,"onUpdate:modelValue":t[9]||(t[9]=o=>i.tempProduct.unit=o),rules:"required"},null,8,["class","modelValue"]),a(m,{class:"invalid-feedback",name:"Unit"})])])])]),e("div",Me,[e("div",Ce,[e("div",Le,[Ve,e("div",Te,[a(n,{type:"number",id:"origin_price",class:c(["form-control",{"is-invalid":p.Origin_price}]),name:"Origin_price",modelValue:i.tempProduct.origin_price,"onUpdate:modelValue":t[10]||(t[10]=o=>i.tempProduct.origin_price=o),modelModifiers:{number:!0},min:"0",rules:"required"},null,8,["class","modelValue"]),a(m,{class:"invalid-feedback",name:"Origin_price"})])])]),e("div",$e,[e("div",Se,[Ee,e("div",De,[a(n,{type:"number",id:"price",class:c(["form-control",{"is-invalid":p.Price}]),name:"Price",modelValue:i.tempProduct.price,"onUpdate:modelValue":t[11]||(t[11]=o=>i.tempProduct.price=o),modelModifiers:{number:!0},min:"0",rules:"required"},null,8,["class","modelValue"]),a(m,{class:"invalid-feedback",name:"Price"})])])])]),e("div",je,[Ne,e("div",Oe,[a(n,{type:"number",id:"num",class:c(["form-control",{"is-invalid":p.Number}]),name:"Number",modelValue:i.tempProduct.num,"onUpdate:modelValue":t[12]||(t[12]=o=>i.tempProduct.num=o),rules:"required"},null,8,["class","modelValue"]),a(m,{class:"invalid-feedback",name:"Number"})])]),e("div",Ie,[Fe,e("div",qe,[a(n,{type:"text",id:"content",class:c(["form-control",{"is-invalid":p.Content}]),name:"Content",modelValue:i.tempProduct.content,"onUpdate:modelValue":t[13]||(t[13]=o=>i.tempProduct.content=o),rules:"required"},null,8,["class","modelValue"]),a(m,{class:"invalid-feedback",name:"Content"})])]),e("div",ze,[Ae,e("div",Be,[a(n,{name:"Description",rules:"required",modelValue:i.tempProduct.description,"onUpdate:modelValue":t[15]||(t[15]=o=>i.tempProduct.description=o)},{default:L(()=>[P(e("textarea",{name:"Description",class:c(["w-100",{"is-invalid":p.Description}]),id:"description",cols:"30",rows:"3",placeholder:"請輸入產品描述","onUpdate:modelValue":t[14]||(t[14]=o=>i.tempProduct.description=o)},null,2),[[V,i.tempProduct.description]]),a(m,{name:"Description",class:"invalid-feedback"})]),_:2},1032,["modelValue"])])]),e("div",Ge,[P(e("input",{type:"checkbox",id:"is_enabled",class:"form-check-input me-2",checked:i.tempProduct.is_enabled,"onUpdate:modelValue":t[16]||(t[16]=o=>i.tempProduct.is_enabled=o)},null,8,He),[[G,i.tempProduct.is_enabled]]),Je])])])]),e("div",We,[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",onClick:t[17]||(t[17]=(...o)=>s.hideModal&&s.hideModal(...o))},"Close"),Re])]),_:1},8,["onSubmit"])])],512)}const Qe=U(J,[["render",Ke]]),Xe="https://ec-course-api.hexschool.io/",Ye="bftsai",Ze={data(){return{tempProduct:{}}},props:{deleteModal:{typeof:Object,default(){return{}}}},mixins:[$],watch:{deleteModal(){this.tempProduct={...this.deleteModal}}},methods:{async deleteProduct(){try{const{id:s}=this.tempProduct;this.$emit("emit-toggleLoading");const t=(await this.axios.delete(`${Xe}/v2/api/${Ye}/admin/product/${s}`)).data;if(this.$emit("emit-toggleLoading"),t.success){const l={icon:"success",title:t.message,timer:1500};this.$swal(l),this.hideModal(),this.tempProduct={},this.$emit("emit-getProducts")}else{const l={icon:"error",title:t.message};this.$swal(l)}}catch(s){console.log(s)}}}},et={class:"modal fade",id:"exampleModal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},tt={class:"modal-dialog modal-xl"},st={class:"modal-content"},it={class:"modal-header"},ot=e("h5",{class:"modal-title fs-5",id:"exampleModalLabel"},"Delete Product",-1),lt={class:"modal-body"},dt={class:"row"},at={class:"col-4"},nt={class:"row"},ct={class:"col-12 mb-3 d-flex flex-wrap justify-content-between"},rt=["src"],mt=["src"],ut={class:"col-8"},gt={class:"mb-3 d-flex align-items-center"},pt={class:"row"},ht={class:"col-6"},_t={class:"mb-3 d-flex align-items-center"},bt={class:"col-6"},ft={class:"mb-3 d-flex align-items-center"},vt={class:"row"},Pt={class:"col-6"},xt={class:"mb-3 d-flex align-items-center"},yt={class:"col-6"},wt={class:"mb-3 d-flex align-items-center"},kt={class:"mb-3 d-flex align-items-center"},Ut={class:"mb-3"},Mt={class:"w-100"},Ct={class:"mb-3 d-flex align-items-center"},Lt={class:"modal-footer"};function Vt(s,t,l,_,i,d){return r(),g("div",et,[e("div",tt,[e("div",st,[e("div",it,[ot,e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:t[0]||(t[0]=(...n)=>s.hideModal&&s.hideModal(...n))})]),e("div",lt,[e("div",dt,[e("div",at,[e("div",nt,[e("div",ct,[e("img",{class:"object-fit-cover w-50 mb-3",src:i.tempProduct.imageUrl,alt:"imageUrl"},null,8,rt),(r(!0),g(M,null,C(i.tempProduct.imagesUrl,(n,m)=>(r(),g("img",{class:"object-fit-cover w-50 mb-3",src:n,alt:"'imagesUrl' + key",key:"imagesUrl"+m},null,8,mt))),128))])])]),e("div",ut,[e("div",gt,[e("p",null,"Title："+u(i.tempProduct.title),1)]),e("div",pt,[e("div",ht,[e("div",_t,[e("p",null,"Category："+u(i.tempProduct.category),1)])]),e("div",bt,[e("div",ft,[e("p",null,"Unit："+u(i.tempProduct.unit),1)])])]),e("div",vt,[e("div",Pt,[e("div",xt,[e("p",null,"origin_price："+u(i.tempProduct.origin_price),1)])]),e("div",yt,[e("div",wt,[e("p",null,"Price："+u(i.tempProduct.price),1)])])]),e("div",kt,[e("p",null,"Content："+u(i.tempProduct.content),1)]),e("div",Ut,[e("div",Mt,[e("p",null,"Description："+u(i.tempProduct.description),1)])]),e("div",Ct,[e("p",{class:c(["text-success",{"text-danger":!i.tempProduct.is_enabled}])},u(i.tempProduct.is_enabled?"啟用":"未啟用"),3)])])])]),e("div",Lt,[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",onClick:t[1]||(t[1]=(...n)=>s.hideModal&&s.hideModal(...n))},"Close"),e("button",{type:"submit",class:"btn btn-outline-danger",onClick:t[2]||(t[2]=(...n)=>d.deleteProduct&&d.deleteProduct(...n))},"Delete Product")])])])],512)}const Tt=U(Ze,[["render",Vt]]),k="https://ec-course-api.hexschool.io/",T="bftsai",$t={data(){return{products:[],paginationObj:{},itemSelect:{},productsNum:0}},components:{ProductCard:E,pagination:D,productModal:Qe,deleteModal:Tt},props:["defaultTheme"],emits:["emit-login","emit-toggleLogin","emit-toggleLoading"],methods:{textDanger(s){return!s&&this.defaultTheme==="light"},textLight(s){return!s&&this.defaultTheme==="dark"},async getAllProducts(){try{const s=(await this.axios.get(`${k}v2/api/${T}/admin/products/all`)).data.products;this.productsNum=Object.keys(s)}catch{}},async getProducts(s=1){try{this.itemSelect={},this.product=[],this.$emit("emit-toggleLoading");const t=(await this.axios.get(`${k}v2/api/${T}/admin/products?page=${s}`)).data;this.products=t.products,this.paginationObj=t.pagination,this.$emit("emit-toggleLoading");const l={icon:"success",title:"已取得產品資料",timer:1500};this.$swal(l)}catch(t){this.$emit("emit-toggleLoading");const l={icon:"error",title:t.response.data.message};this.$swal(l)}},checkProduct(s){this.itemSelect=JSON.parse(JSON.stringify(s))},async checkLogin(){try{this.$emit("emit-toggleLoading");const s=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.axios.defaults.headers.common.Authorization=s;const t=(await this.axios.post(`${k}v2/api/user/check`)).data;this.$emit("emit-toggleLoading"),t.success&&(this.$emit("emit-toggleLogin",t.success),this.getProducts(1))}catch(s){this.$emit("emit-toggleLoading"),this.$emit("emit-toggleLogin",s.response.data.success);const t={icon:"error",title:s.response.data.message,timer:1500};this.$swal(t),s.response.data.success||this.$router.push("login")}},selectPage(s){this.getProducts(s)},productModal(s){s.id?this.itemSelect={...s}:this.itemSelect={imagesUrl:[]},this.$refs.productModal.showModal()},deleteProduct(s){this.itemSelect={...s},this.$refs.deleteModal.showModal()},hideModal(){this.itemSelect={}},toggleLoading(){this.$emit("emit-toggleLoading")}},mounted(){this.$emit("emit-login"),this.checkLogin(),this.getAllProducts()}},St={class:"container"},Et={class:"row"},Dt={class:"col-lg-8"},jt=e("h1",null,"Products List",-1),Nt={class:"table table-hover"},Ot=e("thead",null,[e("tr",{class:"text-center"},[e("th",{class:"w-50",scope:"col"},"產品名稱"),e("th",{scope:"col"},"原價"),e("th",{scope:"col"},"售價"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col"},"查看細節"),e("th",{scope:"col"},"編輯")])],-1),It={class:"w-50 text-start"},Ft=["onClick"],qt={colspan:"2"},zt=["onClick"],At=["onClick"];function Bt(s,t,l,_,i,d){const n=h("productModal"),m=h("deleteModal"),v=h("pagination"),p=h("ProductCard");return r(),g("div",St,[e("div",Et,[e("div",Dt,[a(n,{ref:"productModal","product-modal":i.itemSelect,"emit-hide-modal":d.hideModal,onEmitGetProducts:d.getProducts,onEmitToggleLoading:d.toggleLoading},null,8,["product-modal","emit-hide-modal","onEmitGetProducts","onEmitToggleLoading"]),a(m,{ref:"deleteModal","delete-modal":i.itemSelect,onEmitHideModal:d.hideModal,onEmitGetProducts:d.getProducts,onEmitToggleLoading:d.toggleLoading},null,8,["delete-modal","onEmitHideModal","onEmitGetProducts","onEmitToggleLoading"]),jt,e("button",{class:c(["btn d-block ms-auto",{"btn-secondary":l.defaultTheme==="light","btn-outline-primary":l.defaultTheme==="dark"}]),onClick:t[0]||(t[0]=(...o)=>d.productModal&&d.productModal(...o))},"建立新產品",2),e("table",Nt,[Ot,e("tbody",null,[(r(!0),g(M,null,C(i.products,o=>(r(),g("tr",{key:o.id,class:"text-center"},[e("td",It,u(o.title),1),e("td",null,u(o.origin_price),1),e("td",null,u(o.price),1),e("td",{class:c({"text-danger":d.textDanger(o.is_enabled),"text-light":d.textLight(o.is_enabled)})},u(o.is_enabled?"啟用":"未啟用"),3),e("td",null,[e("button",{type:"button",class:c(["btn w-100 p-1",{"btn-secondary":l.defaultTheme==="light","btn-outline-primary":l.defaultTheme==="dark"}]),onClick:b=>d.checkProduct(o)},"查看細節",10,Ft)]),e("td",qt,[e("button",{type:"button",class:c(["btn p-1 me-3",{"btn-secondary":l.defaultTheme==="light","btn-outline-primary":l.defaultTheme==="dark"}]),onClick:b=>d.productModal(o)},"編輯",10,zt),e("button",{type:"button",class:c(["btn p-1 btn-outline-danger",{"text-primary":l.defaultTheme==="dark"}]),onClick:b=>d.deleteProduct(o)},"刪除",10,At)])]))),128))])]),a(v,{"pagination-obj":i.paginationObj,onEmitSelectPage:d.selectPage},null,8,["pagination-obj","onEmitSelectPage"])]),i.itemSelect.id?(r(),H(p,{key:0,"item-select":i.itemSelect,"default-theme":l.defaultTheme},null,8,["item-select","default-theme"])):f("",!0)])])}const Wt=U($t,[["render",Bt]]);export{Wt as default};
